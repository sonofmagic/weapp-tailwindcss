# packages 代码审查

## 主要问题

1. `packages/weapp-tailwindcss/src/bundlers/webpack/BaseUnifiedPlugin/v5.ts:154` 与 `packages/weapp-tailwindcss/src/bundlers/webpack/BaseUnifiedPlugin/v4.ts:150` 在为 JS/WXS 资源构造缓存键时调用 `removeExt(file)`，导致同一目录下的 `foo.js` 与 `foo.wxs` 共享缓存。开启缓存后，先处理的文件会将结果复用到另一个文件中，出现运行时脚本错位。这个逻辑原本是为了照顾 `.map` 文件，但实际破坏了多扩展名共存的场景，需要保留完整文件名或在 cache key 中附加扩展名，只在处理 source map 时剥离后缀。
2. `packages/tailwindcss-injector/src/postcss.ts:122` 总是将 Tailwind 配置中的 `content` 字段整体替换为数组。当调用方提供 `{ content: { files, extract } }` 等对象格式时，定制的 extractor/transform 会被静默丢弃，Tailwind 无法解析 JSX、Markdown 等自定义语法。应当检测用户传入的结构，只更新 `files`/`content.files`，保留其余选项。

## 建议动作

- 修复 webpack 插件的缓存键生成逻辑，并添加覆盖 JS+WXS 组合的回归测试。
- 调整 tailwindcss-injector 在写入 `content` 时的合并策略，为自定义 extractor 添加测试用例。
