# 故障排除

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [package.json](file://package.json)
- [demo/taro-app/tailwind.config.js](file://demo/taro-app/tailwind.config.js)
- [demo/uni-app/tailwind.config.js](file://demo/uni-app/tailwind.config.js)
- [demo/native-mina/tailwind.config.js](file://demo/native-mina/tailwind.config.js)
- [demo/taro-app/postcss.config.js](file://demo/taro-app/postcss.config.js)
- [demo/uni-app/postcss.config.js](file://demo/uni-app/postcss.config.js)
- [apps/vite-native/tailwind.config.js](file://apps/vite-native/tailwind.config.js)
- [apps/rsmax-app-ts/tailwind.config.js](file://apps/rsmax-app-ts/tailwind.config.js)
- [apps/uni-app-x-hbuilderx-tailwindcss3/tailwind.config.js](file://apps/uni-app-x-hbuilderx-tailwindcss3/tailwind.config.js)
- [apps/vite-native-skyline/tailwind.config.js](file://apps/vite-native-skyline/tailwind.config.js)
- [apps/vite-native-ts/tailwind.config.ts](file://apps/vite-native-ts/tailwind.config.ts)
- [apps/vite-native-ts-skyline/tailwind.config.js](file://apps/vite-native-ts-skyline/tailwind.config.js)
- [apps/web-postcss7-compat/tailwind.config.js](file://apps/web-postcss7-compat/tailwind.config.js)
- [demo/gulp-app/tailwind.config.js](file://demo/gulp-app/tailwind.config.js)
- [demo/mpx-app/tailwind.config.js](file://demo/mpx-app/tailwind.config.js)
- [demo/rax-app/tailwind.config.js](file://demo/rax-app/tailwind.config.js)
- [demo/taro-app-vite/tailwind.config.js](file://demo/taro-app-vite/tailwind.config.js)
- [demo/taro-vite-tailwindcss-v4/postcss.config.mjs](file://demo/taro-vite-tailwindcss-v4/postcss.config.mjs)
- [demo/taro-webpack-tailwindcss-v4/postcss.config.mjs](file://demo/taro-webpack-tailwindcss-v4/postcss.config.mjs)
- [demo/vue-app/postcss.config.mjs](file://demo/vue-app/postcss.config.mjs)
</cite>

## 目录
1. [简介](#简介)
2. [常见问题分类](#常见问题分类)
3. [样式不生效问题排查](#样式不生效问题排查)
4. [类名未生成问题排查](#类名未生成问题排查)
5. [构建失败问题排查](#构建失败问题排查)
6. [框架特定问题](#框架特定问题)
7. [性能问题排查](#性能问题排查)
8. [调试工具与技巧](#调试工具与技巧)
9. [错误报告指南](#错误报告指南)

## 简介

`weapp-tailwindcss` 是一个为小程序开发者提供 Tailwind CSS 支持的全面解决方案，支持多种构建工具和框架，包括 `webpack`、`vite`、`rspack`、`rollup`、`rolldown` 和 `gulp`。本故障排除指南旨在帮助用户解决使用过程中遇到的常见问题，包括样式不生效、类名未生成、构建失败等。通过详细的诊断步骤、根本原因分析和解决方案，帮助开发者快速定位和解决问题。

**Section sources**
- [README.md](file://README.md#L1-L101)

## 常见问题分类

根据项目文档和实际使用情况，`weapp-tailwindcss` 的常见问题主要分为以下几类：

1. **样式不生效**：Tailwind CSS 类名在小程序中未正确应用。
2. **类名未生成**：构建过程中 Tailwind CSS 类名未生成。
3. **构建失败**：构建过程出现错误或异常。
4. **框架特定问题**：在特定框架（如 Taro、uni-app）中遇到的问题。
5. **性能问题**：构建速度慢、内存占用高等。

**Section sources**
- [README.md](file://README.md#L69-L70)

## 样式不生效问题排查

### 问题描述

在使用 `weapp-tailwindcss` 时，发现 Tailwind CSS 类名在小程序中未正确应用，导致样式不生效。

### 诊断步骤

1. 检查 `tailwind.config.js` 文件中的 `content` 配置是否正确，确保包含所有需要扫描的文件路径。
2. 确认 `postcss.config.js` 文件中是否正确配置了 `tailwindcss` 插件。
3. 检查构建工具（如 `webpack`、`vite`）的配置，确保 `postcss` 插件正确加载。
4. 查看浏览器开发者工具或小程序开发者工具，确认生成的 CSS 文件中是否包含预期的类名。

### 根本原因分析

- `content` 配置不正确，导致 Tailwind CSS 无法扫描到需要的文件。
- `postcss` 配置错误，导致 `tailwindcss` 插件未正确加载。
- 构建工具配置问题，导致 `postcss` 插件未正确应用。

### 解决方案

1. 确保 `tailwind.config.js` 文件中的 `content` 配置正确，例如：
   ```javascript
   module.exports = {
     content: ['./src/**/*.{html,js,ts,jsx,tsx}'],
     // 其他配置
   }
   ```
2. 确认 `postcss.config.js` 文件中正确配置了 `tailwindcss` 插件，例如：
   ```javascript
   module.exports = {
     plugins: {
       tailwindcss: {},
       autoprefixer: {},
     }
   }
   ```
3. 检查构建工具配置，确保 `postcss` 插件正确加载。

**Section sources**
- [demo/taro-app/tailwind.config.js](file://demo/taro-app/tailwind.config.js#L4-L9)
- [demo/uni-app/tailwind.config.js](file://demo/uni-app/tailwind.config.js#L5-L6)
- [demo/native-mina/tailwind.config.js](file://demo/native-mina/tailwind.config.js#L2-L3)

## 类名未生成问题排查

### 问题描述

在构建过程中，发现 Tailwind CSS 类名未生成，导致样式无法应用。

### 诊断步骤

1. 检查 `tailwind.config.js` 文件中的 `content` 配置是否正确，确保包含所有需要扫描的文件路径。
2. 确认 `postcss.config.js` 文件中是否正确配置了 `tailwindcss` 插件。
3. 检查构建工具的输出日志，确认 `tailwindcss` 插件是否被正确调用。
4. 查看生成的 CSS 文件，确认是否包含 Tailwind CSS 的基础样式。

### 根本原因分析

- `content` 配置不正确，导致 Tailwind CSS 无法扫描到需要的文件。
- `postcss` 配置错误，导致 `tailwindcss` 插件未正确加载。
- 构建工具配置问题，导致 `postcss` 插件未正确应用。

### 解决方案

1. 确保 `tailwind.config.js` 文件中的 `content` 配置正确，例如：
   ```javascript
   module.exports = {
     content: ['./src/**/*.{html,js,ts,jsx,tsx}'],
     // 其他配置
   }
   ```
2. 确认 `postcss.config.js` 文件中正确配置了 `tailwindcss` 插件，例如：
   ```javascript
   module.exports = {
     plugins: {
       tailwindcss: {},
       autoprefixer: {},
     }
   }
   ```
3. 检查构建工具的输出日志，确认 `tailwindcss` 插件是否被正确调用。

**Section sources**
- [demo/taro-app/tailwind.config.js](file://demo/taro-app/tailwind.config.js#L4-L9)
- [demo/uni-app/tailwind.config.js](file://demo/uni-app/tailwind.config.js#L5-L6)
- [demo/native-mina/tailwind.config.js](file://demo/native-mina/tailwind.config.js#L2-L3)

## 构建失败问题排查

### 问题描述

在构建过程中，出现错误或异常，导致构建失败。

### 诊断步骤

1. 查看构建工具的输出日志，定位具体的错误信息。
2. 检查 `package.json` 文件中的依赖版本，确保兼容性。
3. 确认 `tailwind.config.js` 和 `postcss.config.js` 文件的配置是否正确。
4. 检查构建工具的配置文件，确保所有插件正确加载。

### 根本原因分析

- 依赖版本不兼容，导致构建工具无法正常工作。
- 配置文件错误，导致插件无法正确加载。
- 构建工具配置问题，导致构建过程异常。

### 解决方案

1. 确保 `package.json` 文件中的依赖版本兼容，例如：
   ```json
   {
     "devDependencies": {
       "tailwindcss": "catalog:tailwindcss3",
       "postcss": "catalog:postcss85",
       "autoprefixer": "catalog:autoprefixer10"
     }
   }
   ```
2. 确认 `tailwind.config.js` 和 `postcss.config.js` 文件的配置正确。
3. 检查构建工具的配置文件，确保所有插件正确加载。

**Section sources**
- [package.json](file://package.json#L114-L270)
- [demo/taro-app/postcss.config.js](file://demo/taro-app/postcss.config.js#L37-L41)
- [demo/uni-app/postcss.config.js](file://demo/uni-app/postcss.config.js#L19-L32)

## 框架特定问题

### Taro 框架 HMR 问题

#### 问题描述

在使用 Taro 框架时，热模块替换（HMR）功能失效。

#### 诊断步骤

1. 检查 `postcss.config.js` 文件中的配置，确保 `tailwindcss` 插件正确加载。
2. 确认 `webpack` 配置中是否正确启用了 HMR 功能。
3. 查看构建工具的输出日志，确认 HMR 是否被正确调用。

#### 根本原因分析

- `postcss` 配置错误，导致 `tailwindcss` 插件未正确加载。
- `webpack` 配置问题，导致 HMR 功能未正确启用。

#### 解决方案

1. 确保 `postcss.config.js` 文件中正确配置了 `tailwindcss` 插件，例如：
   ```javascript
   module.exports = {
     plugins: {
       tailwindcss: {},
       autoprefixer: {},
     }
   }
   ```
2. 确认 `webpack` 配置中正确启用了 HMR 功能。

**Section sources**
- [demo/taro-app/postcss.config.js](file://demo/taro-app/postcss.config.js#L37-L41)

### uni-app 多端兼容性问题

#### 问题描述

在使用 uni-app 框架时，多端兼容性出现问题，导致样式在不同平台上表现不一致。

#### 诊断步骤

1. 检查 `tailwind.config.js` 文件中的 `plugins` 配置，确保包含 `weapp-tailwindcss/css-macro` 插件。
2. 确认 `postcss.config.js` 文件中是否正确配置了 `weapp-tailwindcss/css-macro/postcss` 插件。
3. 查看构建工具的输出日志，确认插件是否被正确调用。

#### 根本原因分析

- `tailwind.config.js` 配置错误，导致 `css-macro` 插件未正确加载。
- `postcss` 配置错误，导致 `css-macro/postcss` 插件未正确加载。

#### 解决方案

1. 确保 `tailwind.config.js` 文件中正确配置了 `css-macro` 插件，例如：
   ```javascript
   const cssMacro = require('weapp-tailwindcss/css-macro')
   module.exports = {
     plugins: [
       cssMacro({
         variantsMap: {
           wx: 'MP-WEIXIN',
           '-wx': {
             value: 'MP-WEIXIN',
             negative: true
           }
         }
       })
     ]
   }
   ```
2. 确认 `postcss.config.js` 文件中正确配置了 `weapp-tailwindcss/css-macro/postcss` 插件，例如：
   ```javascript
   module.exports = {
     plugins: [
       require('weapp-tailwindcss/css-macro/postcss')
     ]
   }
   ```

**Section sources**
- [demo/uni-app/tailwind.config.js](file://demo/uni-app/tailwind.config.js#L16-L31)
- [demo/uni-app/postcss.config.js](file://demo/uni-app/postcss.config.js#L28-L32)

## 性能问题排查

### 问题描述

构建速度慢、内存占用高，影响开发效率。

### 诊断步骤

1. 使用构建工具的性能分析功能，定位性能瓶颈。
2. 检查 `tailwind.config.js` 文件中的 `content` 配置，确保路径尽可能精确，避免不必要的文件扫描。
3. 确认 `postcss` 配置中是否启用了不必要的插件。
4. 查看构建工具的输出日志，确认是否有重复的构建任务。

### 根本原因分析

- `content` 配置过于宽泛，导致 Tailwind CSS 扫描大量不必要的文件。
- `postcss` 配置中启用了不必要的插件，增加构建时间。
- 构建工具配置问题，导致重复的构建任务。

### 解决方案

1. 优化 `tailwind.config.js` 文件中的 `content` 配置，例如：
   ```javascript
   module.exports = {
     content: ['./src/components/**/*.{html,js,ts,jsx,tsx}', './src/pages/**/*.{html,js,ts,jsx,tsx}'],
     // 其他配置
   }
   ```
2. 确认 `postcss` 配置中只启用必要的插件。
3. 检查构建工具的配置，避免重复的构建任务。

**Section sources**
- [demo/taro-app/tailwind.config.js](file://demo/taro-app/tailwind.config.js#L4-L9)
- [demo/uni-app/tailwind.config.js](file://demo/uni-app/tailwind.config.js#L5-L6)

## 调试工具与技巧

### 使用日志

- 启用构建工具的详细日志输出，查看详细的构建过程。
- 使用 `console.log` 或调试工具，在关键位置输出调试信息。

### 使用调试器

- 使用 `vscode` 或其他 IDE 的调试功能，设置断点，逐步调试代码。
- 使用浏览器开发者工具或小程序开发者工具，查看生成的 CSS 文件和 DOM 结构。

### 性能分析工具

- 使用构建工具自带的性能分析功能，如 `webpack-bundle-analyzer`。
- 使用 `node` 的 `--inspect` 参数，结合 `chrome devtools` 进行性能分析。

**Section sources**
- [package.json](file://package.json#L48-L55)

## 错误报告指南

### 收集有效信息

1. **错误信息**：完整的错误日志和堆栈跟踪。
2. **复现步骤**：详细描述如何复现问题。
3. **环境信息**：操作系统、Node.js 版本、依赖版本等。
4. **配置文件**：相关的 `tailwind.config.js` 和 `postcss.config.js` 文件内容。

### 报告方式

1. 在 GitHub 仓库中创建 `issue`，提供上述信息。
2. 使用 `weapp-tailwindcss` 的社区群组，寻求帮助。

**Section sources**
- [README.md](file://README.md#L83-L86)