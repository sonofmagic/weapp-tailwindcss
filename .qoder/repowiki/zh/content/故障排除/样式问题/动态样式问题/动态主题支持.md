# 动态主题支持

<cite>
**本文档引用的文件**   
- [theme.css](file://packages/weapp-tailwindcss/css/theme.css)
- [Theme.vue](file://tailwindcss-weapp/src/pages/theme/custom/Theme.vue)
- [index.vue](file://tailwindcss-weapp/src/pages/theme/index.vue)
- [use-theme-preset.ts](file://apps/react-app/src/theme/use-theme-preset.ts)
- [options.ts](file://apps/react-app/src/theme/options.ts)
- [theme.ts](file://apps/vue-app/src/features/home/theme.ts)
- [tailwindcss.ts](file://packages-runtime/theme-transition/src/tailwindcss.ts)
- [index.ts](file://packages-runtime/theme-transition/src/index.ts)
- [preflight.ts](file://packages/postcss/src/preflight.ts)
- [useSystemStore.ts](file://tailwindcss-weapp/src/stores/index.ts)
</cite>

## 目录
1. [简介](#简介)
2. [主题系统实现原理](#主题系统实现原理)
3. [多主题配置示例](#多主题配置示例)
4. [暗色模式检测与切换](#暗色模式检测与切换)
5. [性能优化策略](#性能优化策略)
6. [第三方UI库集成指导](#第三方ui库集成指导)

## 简介

weapp-tailwindcss 提供了强大的动态主题支持功能，允许开发者轻松实现主题切换和暗色模式。该系统基于CSS变量构建，支持静态和动态两种主题切换方式。通过 `mode` 和 `vars` 两个属性，开发者可以灵活地控制主题的外观和行为。

**Section sources**
- [Theme.vue](file://tailwindcss-weapp/src/pages/theme/custom/Theme.vue#L1-L20)

## 主题系统实现原理

weapp-tailwindcss 的主题系统基于CSS变量实现，通过 `@theme` 规则定义主题变量。这些变量涵盖了颜色、间距、字体、边框半径等多个设计系统方面。主题变量在CSS中被定义为自定义属性，可以在运行时通过JavaScript动态修改。

```mermaid
flowchart TD
A[定义主题变量] --> B[编译生成CSS]
B --> C[运行时切换主题]
C --> D[动态更新CSS变量]
D --> E[应用新主题]
```

**Diagram sources**
- [theme.css](file://packages/weapp-tailwindcss/css/theme.css#L1-L457)

**Section sources**
- [theme.css](file://packages/weapp-tailwindcss/css/theme.css#L1-L457)

## 多主题配置示例

以下是一个完整的多主题配置示例，涵盖了颜色、间距、字体等设计系统的各个方面：

```mermaid
classDiagram
class Theme {
+string mode
+Record<string, string> cssVars
+applyTheme()
+getThemeVariables()
}
Theme --> ColorTheme : 继承
Theme --> SpacingTheme : 继承
Theme --> FontTheme : 继承
class ColorTheme {
+string primary
+string secondary
+string accent
}
class SpacingTheme {
+string spacing
+string radius
}
class FontTheme {
+string fontFamily
+string fontSize
+string fontWeight
}
```

**Diagram sources**
- [theme.css](file://packages/weapp-tailwindcss/css/theme.css#L1-L457)
- [Theme.vue](file://tailwindcss-weapp/src/pages/theme/custom/Theme.vue#L1-L20)

**Section sources**
- [theme.css](file://packages/weapp-tailwindcss/css/theme.css#L1-L457)
- [Theme.vue](file://tailwindcss-weapp/src/pages/theme/custom/Theme.vue#L1-L20)

## 暗色模式检测与切换

weapp-tailwindcss 支持多种暗色模式检测和切换机制，包括系统偏好匹配、手动切换和持久化存储。通过 `useThemePreset` 钩子，可以轻松实现主题的初始化和切换。

```mermaid
sequenceDiagram
participant System as 系统偏好
participant App as 应用程序
participant Storage as 存储
participant UI as 用户界面
System->>App : 检测系统偏好
App->>Storage : 读取存储的主题设置
alt 存在存储设置
Storage-->>App : 返回存储的主题
else 无存储设置
App-->>App : 使用系统偏好
end
App->>UI : 应用主题
UI->>App : 用户手动切换主题
App->>Storage : 保存新主题设置
```

**Diagram sources**
- [use-theme-preset.ts](file://apps/react-app/src/theme/use-theme-preset.ts#L1-L31)
- [options.ts](file://apps/react-app/src/theme/options.ts#L1-L23)
- [theme.ts](file://apps/vue-app/src/features/home/theme.ts#L1-L13)

**Section sources**
- [use-theme-preset.ts](file://apps/react-app/src/theme/use-theme-preset.ts#L1-L31)
- [options.ts](file://apps/react-app/src/theme/options.ts#L1-L23)
- [theme.ts](file://apps/vue-app/src/features/home/theme.ts#L1-L13)

## 性能优化策略

为了提高主题切换的性能，weapp-tailwindcss 提供了多种优化策略，包括预生成主题变体和懒加载主题样式。

```mermaid
flowchart LR
A[预生成主题变体] --> B[减少运行时计算]
C[懒加载主题样式] --> D[减少初始加载时间]
E[使用CSS变量] --> F[提高切换速度]
G[持久化存储] --> H[避免重复计算]
```

**Diagram sources**
- [preflight.ts](file://packages/postcss/src/preflight.ts#L1-L26)
- [index.ts](file://packages-runtime/theme-transition/src/index.ts#L54-L93)

**Section sources**
- [preflight.ts](file://packages/postcss/src/preflight.ts#L1-L26)
- [index.ts](file://packages-runtime/theme-transition/src/index.ts#L54-L93)

## 第三方UI库集成指导

weapp-tailwindcss 可以轻松与第三方UI库集成，通过提供统一的主题变量接口，确保UI库的样式与应用程序的主题保持一致。

```mermaid
classDiagram
class AppTheme {
+string primary
+string secondary
+string accent
}
class ThirdPartyUI {
+string themeColor
+string backgroundColor
}
AppTheme --> ThirdPartyUI : 集成
ThirdPartyUI --> AppTheme : 同步
```

**Diagram sources**
- [useSystemStore.ts](file://tailwindcss-weapp/src/stores/index.ts#L1-L30)
- [tailwindcss.ts](file://packages-runtime/theme-transition/src/tailwindcss.ts#L49-L76)

**Section sources**
- [useSystemStore.ts](file://tailwindcss-weapp/src/stores/index.ts#L1-L30)
- [tailwindcss.ts](file://packages-runtime/theme-transition/src/tailwindcss.ts#L49-L76)