# 贡献指南

<cite>
**本文档中引用的文件**
- [CONTRIBUTING.md](file://CONTRIBUTING.md)
- [package.json](file://package.json)
- [pnpm-workspace.yaml](file://pnpm-workspace.yaml)
- [turbo.json](file://turbo.json)
- [README.md](file://README.md)
- [eslint.config.js](file://eslint.config.js)
- [stylelint.config.js](file://stylelint.config.js)
- [vitest.config.ts](file://vitest.config.ts)
- [e2e/vitest.e2e.config.ts](file://e2e/vitest.e2e.config.ts)
- [packages/weapp-tailwindcss/package.json](file://packages/weapp-tailwindcss/package.json)
- [packages/postcss/package.json](file://packages/postcss/package.json)
- [packages/tailwindcss-injector/package.json](file://packages/tailwindcss-injector/package.json)
- [website/package.json](file://website/package.json)
</cite>

## 目录
1. [简介](#简介)
2. [技术栈与开发环境](#技术栈与开发环境)
3. [Monorepo 结构与管理工具](#monorepo-结构与管理工具)
4. [代码贡献流程](#代码贡献流程)
5. [代码风格与 Linting 规则](#代码风格与-linting-规则)
6. [测试策略](#测试策略)
7. [构建与发布](#构建与发布)
8. [文档贡献指南](#文档贡献指南)
9. [社区参与](#社区参与)
10. [结论](#结论)

## 简介

本贡献指南旨在为开发者提供一个清晰的路径，以参与 `weapp-tailwindcss` 项目的开发。该项目是一个为小程序开发者提供 Tailwind CSS JIT 引擎的全面解决方案，支持多种框架和构建工具。通过本指南，您将了解如何设置开发环境、遵循代码规范、运行测试以及提交高质量的贡献。

**Section sources**
- [README.md](file://README.md#L77-L87)
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L2)

## 技术栈与开发环境

### Node.js 版本要求

项目要求使用 Node.js 18 或更高版本。在 `package.json` 文件中明确指定了引擎版本：

```json
"engines": {
  "node": ">=18.0.0"
}
```

### pnpm 作为包管理器

项目使用 pnpm 作为包管理器，并在 `package.json` 中指定了版本：

```json
"packageManager": "pnpm@10.26.1"
```

### TypeScript 版本要求

TypeScript 的版本要求在 `pnpm-workspace.yaml` 的 catalog 中定义：

```yaml
catalogs:
  typescript59:
    typescript: ^5.9.3
```

### 开发环境设置

要设置开发环境，请按照以下步骤操作：

1. 安装 Node.js 18 或更高版本。
2. 安装 pnpm：`npm install -g pnpm`
3. 克隆项目仓库并进入项目目录。
4. 安装依赖：`pnpm install`

**Section sources**
- [package.json](file://package.json#L44-L46)
- [pnpm-workspace.yaml](file://pnpm-workspace.yaml#L98-L101)

## Monorepo 结构与管理工具

### Monorepo 结构

项目采用 Monorepo 架构，使用 pnpm workspaces 进行管理。`pnpm-workspace.yaml` 文件定义了工作区的包：

```yaml
packages:
  - packages/*
  - packages-runtime/*
  - apps/*
  - website
  - benchmark/*
  - e2e
  - '!tailwindcss-weapp'
  - '!**/test/**'
  - demo/*
```

主要目录包括：
- `packages/`: 核心功能包
- `apps/`: 示例应用
- `website/`: 项目文档网站
- `demo/`: 演示应用
- `benchmark/`: 性能基准测试

### Turbo 作为构建工具

项目使用 Turbo 作为构建工具，通过 `turbo.json` 配置任务依赖关系和缓存策略：

```json
{
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**", "build/**"]
    },
    "test": {
      "dependsOn": ["^test"],
      "outputs": ["coverage/**"]
    }
  }
}
```

Turbo 能够智能地缓存任务结果，加速构建过程。

**Section sources**
- [pnpm-workspace.yaml](file://pnpm-workspace.yaml#L1-L11)
- [turbo.json](file://turbo.json#L1-L71)

## 代码贡献流程

### Fork 仓库

首先，Fork 项目仓库到您的 GitHub 账户。

### 创建分支

在本地克隆您的 Fork，然后创建一个新的特性分支：

```bash
git clone https://github.com/your-username/weapp-tailwindcss.git
cd weapp-tailwindcss
git checkout -b feature/your-feature-name
```

### 编写代码

在您的分支上进行代码修改。确保遵循项目的代码风格和最佳实践。

### 添加测试用例

根据 `CONTRIBUTING.md` 的指导，添加相应的测试用例：

> Fork 之后， 添加你的测试用例，测试通过后进行 PR

### 提交 PR

当您完成代码和测试后，提交 Pull Request：

1. 提交您的更改：`git add . && git commit -m "描述您的更改"`
2. 推送到您的 Fork：`git push origin feature/your-feature-name`
3. 在 GitHub 上创建 Pull Request

**Section sources**
- [CONTRIBUTING.md](file://CONTRIBUTING.md#L1-L2)
- [package.json](file://package.json#L48-L55)

## 代码风格与 Linting 规则

### ESLint 配置

项目使用 ESLint 进行 JavaScript/TypeScript 代码的静态分析。配置文件 `eslint.config.js` 基于 `@icebreakers/eslint-config`：

```javascript
import { icebreaker } from '@icebreakers/eslint-config'

export default icebreaker(
  {
    markdown: true,
    ignores: [
      '**/fixtures/**',
      'demo',
      'templates/**',
    ],
    pnpm: false,
  },
  {
    rules: {
      'ts/no-require-imports': 'warn',
    },
  }
)
```

### Stylelint 配置

对于 CSS 代码，项目使用 Stylelint 进行样式检查：

```javascript
import { icebreaker } from '@icebreakers/stylelint-config'

export default icebreaker({
  ignoreFiles: [
    'packages/weapp-tailwindcss/test/fixtures/css/**',
    'packages/weapp-tailwindcss/*.css',
  ],
})
```

### 运行 Linting

您可以使用以下命令运行 linting：

```bash
# 检查代码
pnpm run lint

# 自动修复可修复的问题
pnpm run lint:fix
```

**Section sources**
- [eslint.config.js](file://eslint.config.js#L1-L52)
- [stylelint.config.js](file://stylelint.config.js#L1-L10)
- [package.json](file://package.json#L93-L95)

## 测试策略

### 单元测试

项目使用 Vitest 作为测试框架。`vitest.config.ts` 配置了多项目测试：

```typescript
export default defineConfig(() => {
  return {
    test: {
      projects,
      coverage: {
        enabled: true,
        skipFull: true,
        exclude: ['**/dist/**'],
      },
    },
  }
})
```

### 集成测试

集成测试位于 `e2e/` 目录下，使用 Vitest 进行端到端测试：

```typescript
export default defineConfig({
  test: {
    include: [path.resolve(__dirname, './*.test.ts')],
    testTimeout: 36_000_000,
    globals: true,
    maxConcurrency: 1,
    maxWorkers: 1,
  },
})
```

### 运行测试

您可以使用以下命令运行测试：

```bash
# 运行所有测试
pnpm run test

# 运行特定包的测试
pnpm --filter weapp-tailwindcss test

# 运行端到端测试
pnpm run e2e
```

**Section sources**
- [vitest.config.ts](file://vitest.config.ts#L1-L124)
- [e2e/vitest.e2e.config.ts](file://e2e/vitest.e2e.config.ts#L1-L13)
- [package.json](file://package.json#L56-L67)

## 构建与发布

### 构建命令

项目使用 Turbo 进行构建，支持多种构建目标：

```json
"scripts": {
  "build": "turbo run build",
  "build:docs": "turbo run build --filter=./website/",
  "build:apps": "turbo run build --filter=./apps/*",
  "build:pkgs": "turbo run build --filter=./packages/*"
}
```

### 发布流程

发布流程使用 changesets 进行版本管理和发布：

```json
"scripts": {
  "release": "changeset",
  "pr": "changeset pre enter alpha",
  "cv": "changeset version"
}
```

**Section sources**
- [package.json](file://package.json#L48-L55)
- [package.json](file://package.json#L86-L91)

## 文档贡献指南

### 网站文档

项目文档位于 `website/` 目录，使用 Docusaurus 构建。`website/package.json` 显示了相关依赖：

```json
"dependencies": {
  "@docusaurus/core": "3.9.2",
  "@docusaurus/preset-classic": "3.9.2",
  "react": "catalog:react19",
  "react-dom": "catalog:react19"
}
```

### 更新文档

要更新文档，请修改 `website/docs/` 目录下的相应 Markdown 文件，然后提交 PR。

### 构建文档

使用以下命令构建文档：

```bash
pnpm run build:docs
```

**Section sources**
- [website/package.json](file://website/package.json#L1-L106)
- [package.json](file://package.json#L51-L52)

## 社区参与

### 报告 Bug

如果您遇到任何问题，请在 GitHub Issues 中报告，提供详细的错误信息和复现步骤。

### 提出功能请求

有改进 `weapp-tailwindcss` 的想法吗？请提 issue 来分享您的建议。

### 参与讨论

加入技术交流群，与其他开发者交流经验和想法。

**Section sources**
- [README.md](file://README.md#L83-L86)

## 结论

通过遵循本贡献指南，您可以有效地参与到 `weapp-tailwindcss` 项目的开发中。从设置开发环境到提交代码，再到参与社区讨论，每一步都至关重要。我们欢迎您的贡献，共同打造更好的小程序开发体验。