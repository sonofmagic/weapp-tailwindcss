# 迁移指南

<cite>
**本文档引用的文件**
- [README.md](file://README.md)
- [v1.md](file://v1.md)
- [CHANGELOG.md](file://CHANGELOG.md)
- [packages/weapp-tailwindcss/README.md](file://packages/weapp-tailwindcss/README.md)
</cite>

## 目录
1. [从v1版本迁移到v2/v3](#从v1版本迁移到v2v3)
2. [从原生小程序CSS迁移到Tailwind CSS](#从原生小程序css迁移到tailwind-css)
3. [从其它Tailwind适配方案迁移](#从其它tailwind适配方案迁移)
4. [自动化迁移脚本](#自动化迁移脚本)
5. [常见迁移问题与解决方案](#常见迁移问题与解决方案)
6. [最佳实践](#最佳实践)

## 从v1版本迁移到v2/v3

### 准备工作
在开始迁移之前，请确保您的项目满足以下条件：
- Node.js 版本 >= 16.6.0
- 项目已使用 `weapp-tailwindcss` v1 版本
- 备份当前项目代码，以便在迁移失败时可以回滚

### 破坏性变更（Breaking Changes）
从v1版本迁移到v2/v3版本时，需要注意以下破坏性变更：

1. **插件重构**：v2版本重构了代码和目录结构，去除了所有v1版本的插件。如果您仍想使用v1插件，请将版本锁定在2.1.5以下。
2. **配置项变更**：去除了一些无用的配置项，如 `mpRulePreflight` 已被废弃。
3. **引入方式变更**：vite插件的引入方式发生了变化，需要使用新的导入路径。
4. **依赖变更**：依赖处理方式改变，`postcss` 和 `postcss-selector-parser` 从编译时打入变为安装时连带。

### 迁移步骤
1. **更新依赖**：将 `weapp-tailwindcss` 的版本更新到v2或v3。
   ```bash
   npm install weapp-tailwindcss@latest
   ```
2. **更新配置**：根据新的配置项文档更新 `tailwind.config.js` 文件。
3. **更新引入方式**：如果使用vite插件，更新引入方式：
   ```javascript
   import vwt from 'weapp-tailwindcss-webpack-plugin/vite'
   import postcssWeappTailwindcssRename from 'weapp-tailwindcss-webpack-plugin/postcss'
   ```
4. **测试项目**：运行项目，确保所有功能正常。

### 验证方法
- 检查项目是否能正常编译和运行。
- 验证所有样式是否正确应用。
- 检查是否有任何错误或警告信息。

### 回滚策略
如果迁移过程中出现问题，可以按照以下步骤回滚：
1. 恢复备份的项目代码。
2. 将 `weapp-tailwindcss` 版本降级到v1版本。
3. 恢复旧的配置文件。

**Section sources**
- [README.md](file://README.md#L36)
- [v1.md](file://v1.md#L14)
- [CHANGELOG.md](file://CHANGELOG.md#L316)

## 从原生小程序CSS迁移到Tailwind CSS

### 准备工作
- 确保项目已使用原生小程序CSS。
- 备份当前项目代码。

### 迁移步骤
1. **安装Tailwind CSS**：在项目中安装Tailwind CSS。
   ```bash
   npm install -D tailwindcss
   npx tailwindcss init
   ```
2. **配置Tailwind CSS**：根据项目需求配置 `tailwind.config.js` 文件。
3. **替换CSS类名**：将原生CSS类名替换为Tailwind CSS类名。
4. **测试项目**：运行项目，确保所有样式正确应用。

### 验证方法
- 检查项目是否能正常编译和运行。
- 验证所有样式是否正确应用。
- 检查是否有任何错误或警告信息。

### 回滚策略
如果迁移过程中出现问题，可以按照以下步骤回滚：
1. 恢复备份的项目代码。
2. 移除Tailwind CSS相关依赖。
3. 恢复旧的CSS文件。

**Section sources**
- [README.md](file://README.md#L59)
- [CHANGELOG.md](file://CHANGELOG.md#L107)

## 从其它Tailwind适配方案迁移

### 准备工作
- 确保项目已使用其他Tailwind适配方案，如 `taro-plugin-tailwindcss`。
- 备份当前项目代码。

### 迁移步骤
1. **卸载旧插件**：卸载当前使用的Tailwind适配方案。
   ```bash
   npm uninstall taro-plugin-tailwindcss
   ```
2. **安装新插件**：安装 `weapp-tailwindcss`。
   ```bash
   npm install weapp-tailwindcss
   ```
3. **更新配置**：根据 `weapp-tailwindcss` 的文档更新配置文件。
4. **测试项目**：运行项目，确保所有功能正常。

### 验证方法
- 检查项目是否能正常编译和运行。
- 验证所有样式是否正确应用。
- 检查是否有任何错误或警告信息。

### 回滚策略
如果迁移过程中出现问题，可以按照以下步骤回滚：
1. 恢复备份的项目代码。
2. 重新安装旧的Tailwind适配方案。
3. 恢复旧的配置文件。

**Section sources**
- [README.md](file://README.md#L72)
- [CHANGELOG.md](file://CHANGELOG.md#L107)

## 自动化迁移脚本

### 使用说明
`weapp-tailwindcss` 提供了自动化迁移脚本，可以帮助您快速完成迁移。使用方法如下：

1. **安装脚本**：确保已安装 `weapp-tailwindcss`。
2. **运行脚本**：在项目根目录下运行以下命令：
   ```bash
   npx weapp-tailwindcss migrate
   ```
3. **检查结果**：脚本会自动更新配置文件并提示您需要手动处理的部分。

### 注意事项
- 运行脚本前请备份项目代码。
- 脚本可能无法处理所有特殊情况，建议手动检查迁移结果。

**Section sources**
- [README.md](file://README.md#L72)
- [CHANGELOG.md](file://CHANGELOG.md#L437)

## 常见迁移问题与解决方案

### 问题1：样式丢失
**原因**：可能是由于配置文件未正确更新。
**解决方案**：检查 `tailwind.config.js` 文件，确保所有配置项正确。

### 问题2：编译错误
**原因**：可能是由于依赖版本不兼容。
**解决方案**：检查项目依赖，确保所有依赖版本兼容。

### 问题3：样式不生效
**原因**：可能是由于类名未正确替换。
**解决方案**：检查HTML文件，确保所有类名已替换为Tailwind CSS类名。

**Section sources**
- [README.md](file://README.md#L72)
- [CHANGELOG.md](file://CHANGELOG.md#L314)

## 最佳实践

### 1. 逐步迁移
建议逐步迁移，先迁移部分页面或组件，确保无误后再迁移其他部分。

### 2. 充分测试
迁移完成后，进行全面测试，确保所有功能正常。

### 3. 文档记录
记录迁移过程中的关键步骤和问题，便于后续维护。

### 4. 团队协作
与团队成员充分沟通，确保 everyone 了解迁移计划和进度。

**Section sources**
- [README.md](file://README.md#L72)
- [CHANGELOG.md](file://CHANGELOG.md#L107)