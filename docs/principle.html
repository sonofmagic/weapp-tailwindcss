<!doctype html>
<html lang="zh-cn" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-principle/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">tailwindcss in weapp 的原理 | weapp-tw 把tailwindcss带给小程序开发者们</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://weapp-tw.icebreaker.top/weapp-tailwindcss/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://weapp-tw.icebreaker.top/weapp-tailwindcss/img/logo.png"><meta data-rh="true" property="og:url" content="https://weapp-tw.icebreaker.top/weapp-tailwindcss/docs/principle"><meta data-rh="true" name="docusaurus_locale" content="zh-cn"><meta data-rh="true" name="docsearch:language" content="zh-cn"><meta data-rh="true" name="keywords" content="weapp,小程序,tailwindcss,原子类,uni-app,taro,rax,mpx,native,remax,原生,webpack,plugin,vite,gulp,wxss,wxml"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="tailwindcss in weapp 的原理 | weapp-tw 把tailwindcss带给小程序开发者们"><meta data-rh="true" name="description" content="(2023-03-19) 版本，现在看了一下，已经比较老了，有空再改进改进。"><meta data-rh="true" property="og:description" content="(2023-03-19) 版本，现在看了一下，已经比较老了，有空再改进改进。"><link data-rh="true" rel="icon" href="/weapp-tailwindcss/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://weapp-tw.icebreaker.top/weapp-tailwindcss/docs/principle"><link data-rh="true" rel="alternate" href="https://weapp-tw.icebreaker.top/weapp-tailwindcss/docs/principle" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://weapp-tw.icebreaker.top/weapp-tailwindcss/docs/principle" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9Y7BJULSEW-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S81Q4GRTPM"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-S81Q4GRTPM",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="weapp-tw 把tailwindcss带给小程序开发者们" href="/weapp-tailwindcss/opensearch.xml">



<link rel="preconnect" href="https://hm.baidu.com">
<meta name="baidu-site-verification" content="codeva-4ny6UzMmrn">
<script src="https://hm.baidu.com/hm.js?61f3de7065e36044e6d5f201632bc368" async></script><link rel="stylesheet" href="/weapp-tailwindcss/assets/css/styles.788b43ba.css">
<link rel="preload" href="/weapp-tailwindcss/assets/js/runtime~main.96487f1d.js" as="script">
<link rel="preload" href="/weapp-tailwindcss/assets/js/main.2a38d5c9.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_dkib" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/weapp-tailwindcss/"><div class="navbar__logo"><img src="/weapp-tailwindcss/img/logo.png" alt="weapp tailwindcss Logo" class="themedImage_IW4d themedImage--light_fuKr"><img src="/weapp-tailwindcss/img/logo.png" alt="weapp tailwindcss Logo" class="themedImage_IW4d themedImage--dark_f7P0"></div><b class="navbar__title text--truncate">weapp-tw</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/weapp-tailwindcss/docs/intro">指南</a><a class="navbar__item navbar__link" href="/weapp-tailwindcss/docs/community/templates">生态及解决方案</a><a class="navbar__item navbar__link" href="/weapp-tailwindcss/docs/issues">常见问题</a><a class="navbar__item navbar__link" href="/weapp-tailwindcss/docs/showcase">优秀案例展示</a><a class="navbar__item navbar__link" href="/weapp-tailwindcss/docs/migrations/v2">迁移</a><a class="navbar__item navbar__link" href="/weapp-tailwindcss/docs/options">配置项</a><a class="navbar__item navbar__link" href="/weapp-tailwindcss/docs/api">Types</a><a href="https://icebreaker.top/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">博客<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_rXbd"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/sonofmagic/weapp-tailwindcss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_rXbd"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_tZrk colorModeToggle_SQHg"><button class="clean-btn toggleButton__RJY toggleButtonDisabled_hosl" type="button" disabled="" title="切换浅色/暗黑模式（当前为暗黑模式）" aria-label="切换浅色/暗黑模式（当前为暗黑模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_J21x"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_v99J"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_hMCe"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_cRGG docsWrapper_UQgO"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_jEEy" type="button"></button><div class="docPage_Ls9E"><aside class="theme-doc-sidebar-container docSidebarContainer_kDp1"><div class="sidebarViewport_EEWd"><div class="sidebar_AzuV"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_QLgc"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/weapp-tailwindcss/docs/intro">简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/weapp-tailwindcss/docs/quick-start/install">快速开始</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/weapp-tailwindcss/docs/quick-start/install">1. 安装与配置 tailwindcss</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/weapp-tailwindcss/docs/quick-start/this-plugin">2. 安装这个插件</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/weapp-tailwindcss/docs/quick-start/frameworks/uni-app">3.各个框架的注册方式</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/weapp-tailwindcss/docs/quick-start/frameworks/uni-app">uni-app vue2 webpack</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/weapp-tailwindcss/docs/quick-start/frameworks/uni-app-vite">uni-app vue3 vite</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/weapp-tailwindcss/docs/quick-start/frameworks/hbuilderx">uni-app HbuilderX 使用方式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/weapp-tailwindcss/docs/quick-start/frameworks/taro">Taro v3 (所有框架)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/weapp-tailwindcss/docs/quick-start/frameworks/rax">Rax (react)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/weapp-tailwindcss/docs/quick-start/frameworks/mpx">mpx (原生增强)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/weapp-tailwindcss/docs/quick-start/frameworks/native">原生开发(打包方案)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/weapp-tailwindcss/docs/quick-start/frameworks/api">Nodejs API</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/weapp-tailwindcss/docs/quick-start/rem2rpx">4. rem 转 rpx (或 px)</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/weapp-tailwindcss/docs/community">生态以及解决方案</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/weapp-tailwindcss/docs/quick-start/intelliSense">IDE 智能提示设置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/weapp-tailwindcss/docs/principle">深入核心原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/sonofmagic/weapp-tailwindcss/issues/270" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_I35_">谁在使用？<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_rXbd"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></nav></div></div></aside><main class="docMainContainer_buyQ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_JOIh"><div class="docItemContainer_CoS6"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_MCNB" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/weapp-tailwindcss/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_Ht74"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">深入核心原理</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_cZZe theme-doc-toc-mobile tocMobile_ggNr"><button type="button" class="clean-btn tocCollapsibleButton_FqfE">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>tailwindcss in weapp 的原理</h1></header><p>(2023-03-19) 版本，现在看了一下，已经比较老了，有空再改进改进。</p><h2 class="anchor anchorWithStickyNavbar_oCvx" id="前言">前言<a href="#前言" class="hash-link" aria-label="前言的直接链接" title="前言的直接链接">​</a></h2><p>笔者对 <code>tailwindcss</code> 这一类库的理解还算比较深刻。之前就已经撰写并发布过相关的许多包，比如像 <a href="https://github.com/sonofmagic/tailwindcss-miniprogram-preset" target="_blank" rel="noopener noreferrer"><code>tailwindcss-miniprogram-preset</code></a>, <a href="https://github.com/sonofmagic/weapp-tailwindcss-webpack-plugin" target="_blank" rel="noopener noreferrer"><code>weapp-tailwindcss-webpack-plugin</code></a> <a href="https://github.com/sonofmagic?tab=repositories&amp;q=tailwindcss&amp;type=&amp;language=&amp;sort=" target="_blank" rel="noopener noreferrer">等等大堆的包</a>。</p><p>最近我发布了 <a href="https://github.com/sonofmagic/weapp-tailwindcss-webpack-plugin" target="_blank" rel="noopener noreferrer"><code>weapp-tailwindcss-webpack-plugin</code></a> 的 <code>2.0.0</code>版本，增加了一些核心特性。想着现在也是时候，回顾总结一下这个插件的原理和历程了。回首<code>npm</code>版本发布历史，看到当年发布的第一个正式版，还是在 <code>2022/2/3</code> 号，到现在也已经过去了<code>1</code>年多的时间了，想想岁月真是如白驹过隙，等着等着我们就老了。</p><h2 class="anchor anchorWithStickyNavbar_oCvx" id="这个插件是做什么的">这个插件是做什么的？<a href="#这个插件是做什么的" class="hash-link" aria-label="这个插件是做什么的？的直接链接" title="这个插件是做什么的？的直接链接">​</a></h2><p>简单概括一下，就是把 <code>tailwindcss</code> 相关的特性，带入进小程序开发中。</p><p>为什么需要它呢？核心原因就是，小程序这个平台不像<code>h5</code>那么自由，有很多各式各样的束缚与非标准化的 <code>API</code>。我们以微信小程序为例：</p><p>同<code>css</code>相比，<code>wxss</code>有着更少的选择器支持，同<code>wxml</code>相比，<code>wxml</code>有着更少的字符集支持，<code>js</code> 和 <code>wxs</code> 的运行也是分离的(<code>wxs</code>语法像是一个低版本<code>js</code>)。</p><p>更不用说那些该有的全局对象一个都没有了，比如 <code>Blob</code>,<code>File</code>,<code>FormData</code>, <code>WebSocket</code>,<code>fetch</code>,<code>XmlHttpRequest</code>等等了，这导致许多浏览器包，安装下来无法运行。</p><blockquote><p>举个例子，最近我在做服务端 graphql 改造，市面上主流的 <code>graphql client</code> 直接安装运行会立即报错，因为缺少全局对象，为了兼容它们，于是就写了 <a href="https://www.npmjs.com/package/weapp-websocket" target="_blank" rel="noopener noreferrer"><code>weapp-websocket</code></a> 和 <a href="https://www.npmjs.com/package/weapp-graphql-request" target="_blank" rel="noopener noreferrer"><code>weapp-fetch</code></a> 分别来实现 <code>subscriptions</code> 和 <code>query/mutation</code>。目前在项目里使用，运转良好。</p></blockquote><p>总的来说，由于缺少许多特定的对象和语法上的限制，一些在 <code>h5</code> 上通用的流行库，很有可能在小程序里跑不起来。<code>tailwindcss</code> 便是其中之一，而这个插件就能帮助你在小程序里使用它。</p><h2 class="anchor anchorWithStickyNavbar_oCvx" id="原理篇">原理篇<a href="#原理篇" class="hash-link" aria-label="原理篇的直接链接" title="原理篇的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_oCvx" id="utility-first-css-framework">utility-first CSS framework<a href="#utility-first-css-framework" class="hash-link" aria-label="utility-first CSS framework的直接链接" title="utility-first CSS framework的直接链接">​</a></h3><p>其实吧，市面上的 <code>tailwindcss</code>/<code>windicss</code>/<code>unocss</code> 做的是一回事情。如果用比喻来形容，那么它们就是个带着滤网的字符串漏斗。它们对开发者编写的代码文件内容进行读取，并分割成海量的字符串放入漏斗中，然后经过滤网的过滤，符合条件的就去生成原子类，其余的&quot;残渣&quot;则忽略。</p><p>其中 <code>tailwindcss</code> 大多作为 <code>postcss plugin</code> 来使用的，它源码里自己实现了一个文件读取机制(也就是 <code>tailwind.config.js</code> 中的 <code>content</code> 配置项 )，来对我们编写的代码进行提取。</p><p>而 <code>windicss</code>/<code>unocss</code> 则是依赖 <code>webpack/rollup/vite</code> 这类的 <code>bundler</code>，在打包的过程中获取到 <code>Source / Asset / Chunk</code> 这类的对象，从而提取字符串的。虽然目前 <code>windicss</code>/<code>unocss</code> 都有对应的 <code>postcss plugin</code> 的实现，但是它们大多都是作为实验性质的，并不能很好的复刻它们打包插件的体验。</p><p>是什么造成了它们的不同呢？</p><p>这点其实就要说到 <code>unocss/windicss</code> 它们的优点了。目前 <code>tailwindcss postcss plugin</code> 实际上只有<strong>读</strong>的能力，它来读取我们写的代码，生成原子类。而 <code>windicss</code>/<code>unocss</code> 它们大多作为一个 <code>webpack/vite/rollup plugin</code> 来使用的，所以它们不但拥有读的能力，还拥有<strong>修改</strong>的能力。所以它们能写出这样的代码:</p><div class="language-html codeBlockContainer_d6EA theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_GPFH"><pre tabindex="0" class="prism-code language-html codeBlock_Exvx thin-scrollbar"><code class="codeBlockLines_jGPF"><span class="token-line" style="color:#F8F8F2"><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">button</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">bg</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">blue-400 hover:blue-500 dark:blue-500 dark:hover:blue-600</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">text</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">sm white</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">font</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">mono light</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">p</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">y-2 x-4</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">  </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">border</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">2 rounded blue-200</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Button</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">button</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">div</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">m-2</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">rounded</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">text-teal-400</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><br></span></code></pre><div class="buttonGroup_ixeT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_gMKX" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SaQm"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x5yQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>实际上就是在打包的插件内，展开覆写罢了，本质上还是个语法糖。</p><p>另外目前你选择这种原子类框架的时候，要不选择 <code>tailwindcss</code> 要不就 <code>unocss</code>，目前看起来 <code>windicss</code> 已经死了。</p><h3 class="anchor anchorWithStickyNavbar_oCvx" id="小程序兼容">小程序兼容<a href="#小程序兼容" class="hash-link" aria-label="小程序兼容的直接链接" title="小程序兼容的直接链接">​</a></h3><p>上面说了这么多，接下来来聊聊它们对小程序的兼容，事实上，市面这么多转义的插件，预设啥的，都是一回事。</p><p>思路大多就是把这些原子类<code>css</code>框架，生成的 <code>class</code> 通过重命名，转义，再覆写的方式，去兼容小程序环境。</p><p>说的具体一些，就是对打包后的产物进行修改，把其中的 <code>wxml</code> 里开发者撰写的 <code>className</code> 进行转义，把 <code>js</code> 里写的要应用到 <code>dom</code> 节点上的 <code>className</code> 也进行转义，同时还要对 <code>wxss</code> 里生成的 <code>css</code> 选择器进行转义。</p><p>而这些核心中的核心，便是转义后类名和选择器，一定要相互匹配！！不然生成的结果就是完全错误的。</p><h2 class="anchor anchorWithStickyNavbar_oCvx" id="笔者的实现">笔者的实现<a href="#笔者的实现" class="hash-link" aria-label="笔者的实现的直接链接" title="笔者的实现的直接链接">​</a></h2><p>前面说了这么多，接下来来讲讲我自己的实现。</p><p>实际上我一开始的实现也很简单，在第一版本初期，我选择写了这样一个 <code>webpack plugin</code>：</p><ol><li>它内部用 <code>wxml ast</code> 来解析所有的 <code>wxml</code>模板,以此来获取所有的 <code>className</code> 进行解析和替换</li><li>使用 <code>postcss</code> 来解析所有的 <code>wxss</code>，以此对所有的<code>css</code>选择器进行修改</li><li>使用 <code>babel</code> 来解析所有的 <code>js</code>/<code>jsx</code>，以此来动态修改 <code>jsx?</code> 里所以满足条件的字面量 (<code>StringLiteral</code>)。</li></ol><p>然而理想很丰满，现实很骨感，在实现的过程中，困难一个一个浮现出来了：</p><h3 class="anchor anchorWithStickyNavbar_oCvx" id="js里的字面量转义很容易误伤">js里的字面量转义很容易误伤<a href="#js里的字面量转义很容易误伤" class="hash-link" aria-label="js里的字面量转义很容易误伤的直接链接" title="js里的字面量转义很容易误伤的直接链接">​</a></h3><p>一开始想着直接匹配并且替换掉符合要求的 <code>js</code> 的字面量，于是便兴致勃勃从 <code>tailwindcss</code> 源码里，拷贝来了解析提取器的正则，并在打包后进行匹配和替换。</p><p>然而这个方案失败了，原因是<code>tailwindcss</code>这个正则匹配有可能会把 <code>webpack</code> 它默认注入的一些<code>js code</code>的一些字面量，也给匹配进来，从而造成大面积误伤。这种误伤会导致 <code>js</code> 加载的失败，应用直接就挂了。所以暂时把 <code>js</code>字面量动态修改给去除掉了。同时导出了一个手动标记替换位置的方法：</p><div class="language-js codeBlockContainer_d6EA theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_GPFH"><pre tabindex="0" class="prism-code language-js codeBlock_Exvx thin-scrollbar"><code class="codeBlockLines_jGPF"><span class="token-line" style="color:#F8F8F2"><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token imports"> replaceJs </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;weapp-tailwindcss-webpack-plugin/replace&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> cardsColor </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">reactive</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">replaceJs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;bg-[#4268EA] shadow-indigo-100&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">replaceJs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;bg-[#123456] shadow-blue-100&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup_ixeT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_gMKX" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SaQm"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x5yQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样虽然解决了误伤的问题，但是带来了一些代码的入侵性，导致了开发体验不佳。不过这个问题在 <code>2.0.0</code> 解决了，请继续往下看。</p><h3 class="anchor anchorWithStickyNavbar_oCvx" id="多框架兼容">多框架兼容<a href="#多框架兼容" class="hash-link" aria-label="多框架兼容的直接链接" title="多框架兼容的直接链接">​</a></h3><blockquote><p>源码 <code>framework</code> 部分</p></blockquote><p>正如你看到的，我的这个 <code>plugin</code> 是兼容市面上，几乎所有还活着的主流开发框架的。在开始设计兼容方案的过程中，我发现这些框架编译成小程序的产物各有不同，一类是以 <code>uni-app</code>/<code>mpx</code>/<code>native(原生)</code>为例，它们就是按部就班的把类 <code>vue</code> 模板的写法，转义成小程序模板写法。另外一类是以 <code>taro</code>，<code>rax</code>，<code>remax</code> 为代表的 <code>jsx</code> 写法，这种写法的产物，最大的特点就是页面与组件的 <code>wxml</code> 里往往都是这样的结构：</p><div class="language-html codeBlockContainer_d6EA theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_GPFH"><pre tabindex="0" class="prism-code language-html codeBlock_Exvx thin-scrollbar"><code class="codeBlockLines_jGPF"><span class="token-line" style="color:#F8F8F2"><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">import</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">src</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">../../base.wxml</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">template</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">is</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">taro_tmpl</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">data</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">{{root:root}}</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><br></span></code></pre><div class="buttonGroup_ixeT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_gMKX" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SaQm"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x5yQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>而 <code>base.wxml</code> 文件内则是大量的条件渲染语句，然后在 <code>js</code> 里生成一个对象传入其中，就把整个页面和逻辑渲染出来了。这个方案显然会比模板方案要灵活许多。个人总结，一种偏静态编译，一种偏动态。</p><p>所以开始写的时候插件也分成了 <code>2</code> 个版本，一个是 <code>TemplatePlugin</code> 专门用来处理偏静态的这种框架，一个是 <code>JsxPlugin</code> 负责动态的方案。这 <code>2</code> 种插件的侧重点不同，一个主要替换模板代码，一个则主要转义 <code>jsx</code>，就开发难度来说 <code>jsx</code> 插件要难上许多。</p><h4 class="anchor anchorWithStickyNavbar_oCvx" id="模板插件">模板插件<a href="#模板插件" class="hash-link" aria-label="模板插件的直接链接" title="模板插件的直接链接">​</a></h4><blockquote><p>源码 <code>base/BaseTemplatePlugin</code> 和 <code>wxml</code> 部分</p></blockquote><p>模板那个插件，要做的是解析所有的 <code>dom</code> 的 <code>class</code> 属性，但是这个属性里很有可能会存在 <code>js</code>表达式(<code>{{}}</code>包裹的部分)。</p><p>如果是不带表达式的，可以直接转义覆写，带表达式的会稍微复杂一点，我需要去预估开发者所使用的语法，比如开发者经常会使用一些数组绑定的语法，或者多元条件运算符，例如 <code>x?y:z?a:b</code> 来撰写类名。这就代表着我们需要像解析 <code>js</code> 那样去解析 <code>{{}}</code> 内部包着的表达式，再通过语法的检测去进行替换。</p><p>比如 <code>x?y:z?a:b</code> 派生的 <code>{{ flag ? &#x27;bg-[#123456]&#x27; : otherFlag ? &#x27;text-[50px]&#x27; : &#x27;text-[#654321]&#x27; }}</code> 我们就需要匹配 <code>3</code> 个字面量进行转义。</p><h4 class="anchor anchorWithStickyNavbar_oCvx" id="jsx插件">jsx插件<a href="#jsx插件" class="hash-link" aria-label="jsx插件的直接链接" title="jsx插件的直接链接">​</a></h4><blockquote><p>源码 <code>base/BaseJsxPlugin</code> 和 <code>jsx</code> 部分</p></blockquote><p>这个插件的开发难度更高，因为我发现就单单 <code>taro</code> 一个框架，它就支持 <code>react</code>/ <code>preact</code>/ <code>vue2</code> / <code>vue3</code> 这些框架，要命的是，<code>react</code>/<code>vue2</code>/<code>vue3</code> 它们构建出来的产物，有很大的不同。</p><blockquote><p>这点你可以通过我 <code>src/jsx</code> 目录下的源码，和相应的<code>jest</code>单元测试快照，查看它们的差别。</p></blockquote><p>所以我在配置项里，除了原先的 <code>appType</code>(框架) 之外又加了一个 <code>framework</code> 专门提供给 <code>taro</code>，通过传入 <code>react/vue2/vue3</code> 让它们走各自不同的 <code>jsx?</code> 替换策略。</p><p>当然这样远远没有解决问题，毕竟原先插件是在 <code>processAssets</code> 这个<code>hook</code>去执行的核心逻辑，相比较来说还是偏晚的，还可能有误伤的问题存在。为此我做了一些努力：</p><ol><li>在替换字面量时，只匹配 <code>react/vue2/vue3</code>的<code>return</code>模板部分代码，放弃函数作用域内字面量的匹配和替换。</li><li>为了让这个转义替换的范围足够的精确，就必须要尽可能的提前执行。于是基于这个思路，我想到了在插件里，动态去插入一个自己的 <code>webpack-loader</code>:<code>jsx-rename-loader</code> (见源码 <code>src/loader</code> )</li></ol><p>这个 <code>loader</code> 会被动态的插入 <code>jsx?</code> 文件的加载读取序列中，并确保它在队列的最先执行，即 <code>babel-loader</code> 或 <code>ts-loader</code> 之前。这样在这个<code>loader</code>内部执行转义的时候，得到的原始内容就非常贴近用户自己编写的代码了。</p><h4 class="anchor anchorWithStickyNavbar_oCvx" id="webpack45-和-vite-的兼容">webpack4/5 和 vite 的兼容<a href="#webpack45-和-vite-的兼容" class="hash-link" aria-label="webpack4/5 和 vite 的兼容的直接链接" title="webpack4/5 和 vite 的兼容的直接链接">​</a></h4><blockquote><p>源码 <code>base</code> -&gt; <code>v4/v5</code> 部分</p></blockquote><p>这一块也是由于各个框架，使用的 <code>webpack</code> / <code>postcss</code> 版本不同导致的。</p><p>不过要达成这个目标还是比较简单的，看看<code>webpack</code>文档就可以了，而 <code>rollup/vite</code> 这种，它们本身的 <code>API</code> 就要比 <code>webpack</code> 简单，实现起来也非常简单。</p><p>具体举一些例子便是:</p><div class="language-js codeBlockContainer_d6EA theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_GPFH"><pre tabindex="0" class="prism-code language-js codeBlock_Exvx thin-scrollbar"><code class="codeBlockLines_jGPF"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// webpack5 动态插入 loader</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">NormalModule</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;webpack&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token maybe-class-name">NormalModule</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">getCompilationHooks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">loader</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pluginName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">loaderContext</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// webpack4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">normalModuleLoader</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">tap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pluginName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">loaderContext</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> module</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// webpack5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">processAssets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// webpack4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">compilation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">hooks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">optimizeChunkAssets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// webpack5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token maybe-class-name">Compilation</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> compiler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">webpack</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access maybe-class-name">Compilation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token maybe-class-name">ConcatSource</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> compiler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">webpack</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token property-access">sources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// webpack4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">ConcatSource</span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">Source</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;webpack-sources&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 还有 `loader-utils` 的版本问题</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token imports"> getOptions </span><span class="token imports punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;loader-utils&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 还有 Compilation 封闭后 assets 对象不可修改问题等等等等</span><br></span></code></pre><div class="buttonGroup_ixeT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_gMKX" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SaQm"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x5yQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这种问题只要愿意多调试，都能解决。</p><h3 class="anchor anchorWithStickyNavbar_oCvx" id="css-选择器替换">css 选择器替换<a href="#css-选择器替换" class="hash-link" aria-label="css 选择器替换的直接链接" title="css 选择器替换的直接链接">​</a></h3><blockquote><p>源码 <code>postcss</code> 部分</p></blockquote><p>这部分是 <code>postcss</code> 的主场，我们知道 <code>postcss</code> 本质上就是一个 <code>css ast</code> 工具。有了 <code>ast</code> 才有了各种各样的转化插件来生成 <code>css</code>。</p><p>现在我们使用它的核心目标为：找到所有 <code>tailwindcss</code> 的生成块，对选择器进行转义。</p><p>我们先来解决第一个问题: 怎么找？</p><h4 class="anchor anchorWithStickyNavbar_oCvx" id="找到tailwindcss节点">找到tailwindcss节点<a href="#找到tailwindcss节点" class="hash-link" aria-label="找到tailwindcss节点的直接链接" title="找到tailwindcss节点的直接链接">​</a></h4><blockquote><p>源码 <code>postcss/mp</code> 部分</p></blockquote><p>各个框架，它们公共样式文件的路径不同的。比如 <code>uni-app</code> 的路径就是 <code>common/main.wxss</code>，<code>taro</code> 则为 <code>app.wxss</code> ，而某些框架更加的奇葩，<code>common/miniprogram-app.wxss</code> 等等，这简直就是简直了。</p><p>所以我们可以通过用户传入的 <code>appType</code> 这个框架类型，以此来精确定位公共样式的位置。不过这个方案后续还经过了许多的优化，核心便是利用 <code>postcss</code> 解析，对 <code>tailwindcss</code> 所在的文件位置，进行猜测。</p><p>这个猜测的方案是由于 <code>tailwindcss</code> 的特性实现的。因为 <code>tailwindcss</code> 它在生成原子类之前，它会先去注入大量的 <code>css</code> 变量，以此来控制所有的原子类的呈现。</p><p>所以我们会看到这样一个 <code>css</code> 节点</p><div class="language-css codeBlockContainer_d6EA theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_GPFH"><pre tabindex="0" class="prism-code language-css codeBlock_Exvx thin-scrollbar"><code class="codeBlockLines_jGPF"><span class="token-line" style="color:#F8F8F2"><span class="token selector" style="color:rgb(255, 121, 198)">*</span><span class="token selector punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token selector pseudo-element" style="color:rgb(255, 121, 198)">:after</span><span class="token selector punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token selector pseudo-element" style="color:rgb(255, 121, 198)">:before</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">--tw-border-spacing-x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">--tw-border-spacing-y</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">--tw-translate-x</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">--tw-translate-y</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">--tw-rotate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">/* ..... */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup_ixeT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_gMKX" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SaQm"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x5yQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>那么我们就可以认为，找到它，这个文件就是公共样式的所在之处了。不过在寻址时要注意选择器条件和 <code>-tw-</code> 变量条件，以此做到精确匹配。</p><h4 class="anchor anchorWithStickyNavbar_oCvx" id="转义原子类选择器">转义原子类选择器<a href="#转义原子类选择器" class="hash-link" aria-label="转义原子类选择器的直接链接" title="转义原子类选择器的直接链接">​</a></h4><blockquote><p>源码 <code>postcss/selectorParser</code> 和 <code>shared</code> 部分</p></blockquote><p>第一个问题解决了，第二个问题接踵而至，怎么换？</p><p>直接对所有的选择器进行转义可行吗？显然是不可行的，这只会导致 <code>css</code> 的大面积误伤。</p><p>我们知道一个<code>css</code>选择器，可能很简单也可以很复杂，它可以包含相邻兄弟选择器，子选择器，后代选择器，通用兄弟选择器，伪类选择器，伪元素选择器，还能使用 <code>,</code> 来添加选择器。我们必须要对选择器进一步解析，从而做到精确匹配和转义。</p><p>这时候就需要 <code>postcss-selector-parser</code> 出场了。</p><p>我们在使用 <code>postcss</code> 进行 <code>root.walk</code> 之后，再把符合条件的 <code>css</code> 节点进行 <code>selectors.walk</code>，从而达成了选择器局部精确转义的效果。</p><p>另外由于 <code>tailwindcss</code> 默认的 <code>preflight</code> 是针对 <code>h5</code> 的，所以我们也需要注入自己的小程序 <code>preflight</code>，还有一点值得注意就是， <code>js/wxml</code> 的转义方法和 <code>wxss</code> 的转义方法是不同的，因为 <code>css</code> 中，往往会多加一个 <code>\</code> 字符。</p><h3 class="anchor anchorWithStickyNavbar_oCvx" id="模板解析的重新实现">模板解析的重新实现<a href="#模板解析的重新实现" class="hash-link" aria-label="模板解析的重新实现的直接链接" title="模板解析的重新实现的直接链接">​</a></h3><blockquote><p>源码 <code>reg</code> 和 <code>wxml/utils</code> 部分</p></blockquote><p>原先用的 <code>wxml ast</code> 是第三方的，已经彻底没人维护了，一直出 <code>bug</code>(比如<code>wxml</code>内联<code>wxs</code>)，于是自己基于正则写了一个模板属性提取器。</p><p>这是由于日益增长的需求导致的，原先可能想着模板里，只要支持 <code>class</code>/ <code>hover-class</code> 这类的属性转义就够了。但是后续发现，用户在定义和使用组件的时候，也会经常把 <code>className</code> 作为属性传入进组件，这时候就需要我们自定义生成正则，来对满足条件的属性进行转义了。比如:</p><div class="language-html codeBlockContainer_d6EA theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_GPFH"><pre tabindex="0" class="prism-code language-html codeBlock_Exvx thin-scrollbar"><code class="codeBlockLines_jGPF"><span class="token-line" style="color:#F8F8F2"><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">my-com</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">bg-[#123456]</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">hover-class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">bg-[#654321]</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">custom-class</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">text-[#ff00ff]</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">happy-attr</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">text-[green]</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">sad-attr</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">text-[blue]</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">my-com</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><br></span></code></pre><div class="buttonGroup_ixeT"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_gMKX" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_SaQm"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x5yQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>默认只匹配转义 <code>2</code> 个，怎么行呢？所以开放了 <code>customAttributesEntities</code> 配置项，这个配置项会和原先 <code>class</code>/ <code>hover-class</code> 相关的属性一起进行匹配，从而转化上述例子中所有的 <code>Arbitrary values</code>。</p><h3 class="anchor anchorWithStickyNavbar_oCvx" id="动态源码补丁">动态源码补丁<a href="#动态源码补丁" class="hash-link" aria-label="动态源码补丁的直接链接" title="动态源码补丁的直接链接">​</a></h3><blockquote><p>源码 <code>tailwindcss</code> 部分</p></blockquote><p>很多时候，出于 <code>tailwindcss</code> 自身的限制，和技术国情等等原因。我们的 <code>pr</code> 往往不会被他们接受，这时候我们就需要自己去修改他们的源码，从而封装一个符合中国国情的 <code>tailwindcss</code>。这种可以通过 <code>fork</code> 一个新的版本进行发布来做到，也可以通过给源码打补丁做到。</p><blockquote><p>注意点：给源码打补丁，这个操作一定要是幂等的，不然重复执行可能会破坏源码的结构</p></blockquote><h4 class="anchor anchorWithStickyNavbar_oCvx" id="支持自定义长度单位rpx">支持自定义长度单位(rpx)<a href="#支持自定义长度单位rpx" class="hash-link" aria-label="支持自定义长度单位(rpx)的直接链接" title="支持自定义长度单位(rpx)的直接链接">​</a></h4><blockquote><p>源码 <code>tailwindcss/supportCustomUnit</code> 部分</p></blockquote><p>自从 <code>tailwindcss 3.2.x</code> 开始，由于加入了单位分类校验 <a href="https://github.com/sonofmagic/weapp-tailwindcss-webpack-plugin/issues/110" target="_blank" rel="noopener noreferrer">issue#110</a> 导致原先一些直接在类名里写 <code>rpx</code> 的原子类，被错误识别然后被转化成了颜色。</p><p>什么意思呢？</p><p>比如现在有三个原子类，<code>text-[#123]</code>，<code>text-[30rpx]</code>，<code>text-[30px]</code>，在 <code>3.2.x</code> 之前，前一个是字体颜色，后面两个是字体的大小。在这个版本之后，前 <strong>2</strong> 个是颜色，只有最后一个是字体大小了！</p><p>这是因为 <code>tailwindcss</code> 会对 <code>mdn</code> 上合法长度单位进行校验，在合法长度单位列表内，则认为是字体大小，反之则为字体颜色。而 <code>rpx</code> 这个单位是微信的独创，不是一个标准的 <code>css</code> 单位，自然就在合法长度单位这个集合之外了。</p><p>那么如何进行修复支持呢？通过阅读 <code>tailwindcss</code> 的源码，会发现它校验单位的方法在 <code>utils/dataType.js</code> 这个文件里。</p><p>再通过 <code>babel</code> 三件套: <code>parse</code>，<code>traverse</code>,<code>generate</code> 可以精确锁定暴露的合法变量列表位置，然后把 <code>rpx</code> 这个单位 <code>push</code> 进 <code>ast node.elements</code>之后，重新生成覆写即可。</p><h2 class="anchor anchorWithStickyNavbar_oCvx" id="20-增加了什么">2.0 增加了什么？<a href="#20-增加了什么" class="hash-link" aria-label="2.0 增加了什么？的直接链接" title="2.0 增加了什么？的直接链接">​</a></h2><p>这个版本新增了 <code>UnifiedWebpackPluginV5</code>
和 <code>UnifiedViteWeappTailwindcssPlugin</code> 这种以 <code>Unified</code> 开头的插件。</p><p>它们能够自动识别并精确处理所有 <code>tailwindcss</code> 的工具类，这意味着它可以同时处理 <code>wxss</code>,<code>wxml</code> 和 <code>js</code> 里静态和动态的 <code>class</code>(v1版本只有处理<code>wxss</code>,<code>wxml</code>静态<code>class</code>的能力)。所以你再也不需要在 <code>js</code> 里引入并调用 <code>replaceJs</code>方法了！由于 <code>2.x</code> 插件有精准转化 <code>js</code>/<code>jsx</code> 的能力，误伤问题得到了有效的解决，也大大提升了 <code>taro</code> 这种动态模板框架的开发体验。</p><p>欢迎体验，<code>star</code>/<code>fork</code>。</p><h2 class="anchor anchorWithStickyNavbar_oCvx" id="尾言">尾言<a href="#尾言" class="hash-link" aria-label="尾言的直接链接" title="尾言的直接链接">​</a></h2><p>正如马克·吐温的名言： <code>To a man with a hammer, everything looks like a nail</code>。</p><p>笔者的方案肯定也会有许多的局限性，本篇文章也不可避免的会出现许多的勘误。</p><p>欢迎大佬们指出，也欢迎大家的建议和指点 ^_^</p><p>作者: <a href="https://github.com/sonofmagic" target="_blank" rel="noopener noreferrer">ice breaker</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/sonofmagic/weapp-tailwindcss/tree/main/website/docs/principle/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_bpV1" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_OQbr"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/weapp-tailwindcss/docs/quick-start/intelliSense"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">IDE 智能提示设置</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_o7aM thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#前言" class="table-of-contents__link toc-highlight">前言</a></li><li><a href="#这个插件是做什么的" class="table-of-contents__link toc-highlight">这个插件是做什么的？</a></li><li><a href="#原理篇" class="table-of-contents__link toc-highlight">原理篇</a><ul><li><a href="#utility-first-css-framework" class="table-of-contents__link toc-highlight">utility-first CSS framework</a></li><li><a href="#小程序兼容" class="table-of-contents__link toc-highlight">小程序兼容</a></li></ul></li><li><a href="#笔者的实现" class="table-of-contents__link toc-highlight">笔者的实现</a><ul><li><a href="#js里的字面量转义很容易误伤" class="table-of-contents__link toc-highlight">js里的字面量转义很容易误伤</a></li><li><a href="#多框架兼容" class="table-of-contents__link toc-highlight">多框架兼容</a></li><li><a href="#css-选择器替换" class="table-of-contents__link toc-highlight">css 选择器替换</a></li><li><a href="#模板解析的重新实现" class="table-of-contents__link toc-highlight">模板解析的重新实现</a></li><li><a href="#动态源码补丁" class="table-of-contents__link toc-highlight">动态源码补丁</a></li></ul></li><li><a href="#20-增加了什么" class="table-of-contents__link toc-highlight">2.0 增加了什么？</a></li><li><a href="#尾言" class="table-of-contents__link toc-highlight">尾言</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/weapp-tailwindcss/docs/intro">指南</a></li><li class="footer__item"><a class="footer__link-item" href="/weapp-tailwindcss/docs/options">配置项</a></li><li class="footer__item"><a class="footer__link-item" href="/weapp-tailwindcss/docs/issues">常见问题</a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/sonofmagic/weapp-tailwindcss" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_rXbd"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://icebreaker.top" target="_blank" rel="noopener noreferrer" class="footer__link-item">博客<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_rXbd"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ui.icebreaker.top/zh-CN" target="_blank" rel="noopener noreferrer" class="footer__link-item">IceStack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_rXbd"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/sonofmagic/weapp-pandacss" target="_blank" rel="noopener noreferrer" class="footer__link-item">weapp-pandacss<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_rXbd"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><div class="flex justify-center space-x-2">
        <span>Copyright © 2024 icebreaker</span> <a target="_blank" rel="nofollow" href="http://beian.miit.gov.cn">苏ICP备19002675号-2</a> <span class="flex items-center space-x-1"><img src="/img/beian.png" class="h-4"> <a target="_blank" rel="noreferrer" href="https://beian.mps.gov.cn/#/query/webSearch?code=32050602011962">苏公网安备32050602011962</a></span></div></div></div></div></footer></div>
<script src="/weapp-tailwindcss/assets/js/runtime~main.96487f1d.js"></script>
<script src="/weapp-tailwindcss/assets/js/main.2a38d5c9.js"></script>
</body>
</html>